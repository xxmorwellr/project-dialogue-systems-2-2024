{"version":3,"file":"AudioContextQueue.js","names":["audioContext","ponyfill","consumer","paused","queue","getAudioContext","memoize","AudioContext","pause","utterance","push","startConsumer","resume","length","AudioContextConsumer","start","splice","stop"],"sources":["../../../src/SpeechServices/TextToSpeech/AudioContextQueue.js"],"sourcesContent":["/* eslint no-await-in-loop: \"off\" */\n\nimport memoize from 'memoize-one';\n\nimport AudioContextConsumer from './AudioContextConsumer';\n\nexport default class {\n  constructor({ audioContext, ponyfill }) {\n    this.consumer = null;\n    this.paused = false;\n    this.queue = [];\n\n    this.getAudioContext = memoize(() => audioContext || new ponyfill.AudioContext());\n  }\n\n  pause() {\n    this.paused = true;\n    this.consumer && this.consumer.pause();\n  }\n\n  push(utterance) {\n    this.queue.push(utterance);\n    this.startConsumer();\n  }\n\n  resume() {\n    this.paused = false;\n\n    if (this.consumer) {\n      this.consumer.resume();\n    } else {\n      this.startConsumer();\n    }\n  }\n\n  get speaking() {\n    return !!this.consumer;\n  }\n\n  async startConsumer() {\n    while (!this.paused && this.queue.length && !this.consumer) {\n      this.consumer = new AudioContextConsumer(this.getAudioContext());\n\n      await this.consumer.start(this.queue);\n\n      this.consumer = null;\n    }\n  }\n\n  stop() {\n    this.queue.splice(0);\n    this.consumer && this.consumer.stop();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;AAEA;;AAEA;;AAJA;;EAOE,wBAAwC;IAAA,IAA1BA,YAA0B,QAA1BA,YAA0B;IAAA,IAAZC,QAAY,QAAZA,QAAY;IAAA;IACtC,KAAKC,QAAL,GAAgB,IAAhB;IACA,KAAKC,MAAL,GAAc,KAAd;IACA,KAAKC,KAAL,GAAa,EAAb;IAEA,KAAKC,eAAL,GAAuB,IAAAC,mBAAA,EAAQ;MAAA,OAAMN,YAAY,IAAI,IAAIC,QAAQ,CAACM,YAAb,EAAtB;IAAA,CAAR,CAAvB;EACD;;;;WAED,iBAAQ;MACN,KAAKJ,MAAL,GAAc,IAAd;MACA,KAAKD,QAAL,IAAiB,KAAKA,QAAL,CAAcM,KAAd,EAAjB;IACD;;;WAED,cAAKC,SAAL,EAAgB;MACd,KAAKL,KAAL,CAAWM,IAAX,CAAgBD,SAAhB;MACA,KAAKE,aAAL;IACD;;;WAED,kBAAS;MACP,KAAKR,MAAL,GAAc,KAAd;;MAEA,IAAI,KAAKD,QAAT,EAAmB;QACjB,KAAKA,QAAL,CAAcU,MAAd;MACD,CAFD,MAEO;QACL,KAAKD,aAAL;MACD;IACF;;;SAED,eAAe;MACb,OAAO,CAAC,CAAC,KAAKT,QAAd;IACD;;;;mGAED;QAAA;UAAA;YAAA;cAAA;gBAAA,MACS,CAAC,KAAKC,MAAN,IAAgB,KAAKC,KAAL,CAAWS,MAA3B,IAAqC,CAAC,KAAKX,QADpD;kBAAA;kBAAA;gBAAA;;gBAEI,KAAKA,QAAL,GAAgB,IAAIY,6BAAJ,CAAyB,KAAKT,eAAL,EAAzB,CAAhB;gBAFJ;gBAAA,OAIU,KAAKH,QAAL,CAAca,KAAd,CAAoB,KAAKX,KAAzB,CAJV;;cAAA;gBAMI,KAAKF,QAAL,GAAgB,IAAhB;gBANJ;gBAAA;;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,C;;;;;;;;;;WAUA,gBAAO;MACL,KAAKE,KAAL,CAAWY,MAAX,CAAkB,CAAlB;MACA,KAAKd,QAAL,IAAiB,KAAKA,QAAL,CAAce,IAAd,EAAjB;IACD"}