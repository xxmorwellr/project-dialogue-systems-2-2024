{"version":3,"file":"fetchSpeechData.js","names":["DEFAULT_LANGUAGE","DEFAULT_OUTPUT_FORMAT","DEFAULT_VOICE","EMPTY_MP3_BASE64","deploymentId","fetchCredentials","lang","outputFormat","pitch","rate","text","voice","volume","decode","authorizationToken","region","speechSynthesisHostname","subscriptionKey","Error","ssml","isSSML","buildSSML","hostname","encodeURI","search","url","fetch","headers","Authorization","method","body","res","ok","status","arrayBuffer"],"sources":["../../../src/SpeechServices/TextToSpeech/fetchSpeechData.js"],"sourcesContent":["import { decode } from 'base64-arraybuffer';\nimport buildSSML from './buildSSML';\nimport isSSML from './isSSML';\n\nconst DEFAULT_LANGUAGE = 'en-US';\nconst DEFAULT_OUTPUT_FORMAT = 'riff-16khz-16bit-mono-pcm';\nconst DEFAULT_VOICE = 'Microsoft Server Speech Text to Speech Voice (en-US, AriaNeural)';\nconst EMPTY_MP3_BASE64 =\n  'SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjU2LjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjY0AAAAAAAAAAAAAAAAJAUHAAAAAAAAAYYoRBqpAAAAAAD/+xDEAAPAAAGkAAAAIAAANIAAAARMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMQpg8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';\n\nexport default async function({\n  deploymentId,\n  fetchCredentials,\n  lang = DEFAULT_LANGUAGE,\n  outputFormat = DEFAULT_OUTPUT_FORMAT,\n  pitch,\n  rate,\n  text,\n  voice = DEFAULT_VOICE,\n  volume\n}) {\n  if (!text) {\n    // If text is empty, play a short audio clip. This allows developers to easily prime the AudioContext object by playing an empty string.\n    return decode(EMPTY_MP3_BASE64);\n  }\n\n  const { authorizationToken, region, speechSynthesisHostname, subscriptionKey } = await fetchCredentials();\n\n  if ((authorizationToken && subscriptionKey) || (!authorizationToken && !subscriptionKey)) {\n    throw new Error('Only \"authorizationToken\" or \"subscriptionKey\" should be set.');\n  } else if ((region && speechSynthesisHostname) || (!region && !speechSynthesisHostname)) {\n    throw new Error('Only \"region\" or \"speechSynthesisHostnamename\" should be set.');\n  }\n\n  const ssml = isSSML(text) ? text : buildSSML({ lang, pitch, rate, text, voice, volume });\n\n  // Although calling encodeURI on hostname does not actually works, it fails faster and safer.\n  const hostname =\n    speechSynthesisHostname ||\n    (deploymentId\n      ? `${ encodeURI(region) }.voice.speech.microsoft.com`\n      : `${ encodeURI(region) }.tts.speech.microsoft.com`);\n  const search = deploymentId ? `?deploymentId=${ encodeURI(deploymentId) }` : '';\n  const url = `https://${ hostname }/cognitiveservices/v1${ search }`;\n\n  const res = await fetch(url, {\n    headers: {\n      'Content-Type': 'application/ssml+xml',\n      'X-Microsoft-OutputFormat': outputFormat,\n      ...(authorizationToken\n        ? {\n            Authorization: `Bearer ${ authorizationToken }`\n          }\n        : {\n            'Ocp-Apim-Subscription-Key': subscriptionKey\n          })\n    },\n    method: 'POST',\n    body: ssml\n  });\n\n  if (!res.ok) {\n    throw new Error(`web-speech-cognitive-services: Failed to syntheis speech, server returned ${ res.status }`);\n  }\n\n  return res.arrayBuffer();\n}\n"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;AAEA,IAAMA,gBAAgB,GAAG,OAAzB;AACA,IAAMC,qBAAqB,GAAG,2BAA9B;AACA,IAAMC,aAAa,GAAG,kEAAtB;AACA,IAAMC,gBAAgB,GACpB,skBADF;;;;;;;kFAGe;IAAA;;IAAA;MAAA;QAAA;UAAA;YACbC,YADa,QACbA,YADa,EAEbC,gBAFa,QAEbA,gBAFa,mBAGbC,IAHa,EAGbA,IAHa,0BAGNN,gBAHM,uCAIbO,YAJa,EAIbA,YAJa,kCAIEN,qBAJF,sBAKbO,KALa,QAKbA,KALa,EAMbC,IANa,QAMbA,IANa,EAObC,IAPa,QAObA,IAPa,oBAQbC,KARa,EAQbA,KARa,2BAQLT,aARK,eASbU,MATa,QASbA,MATa;;YAAA,IAWRF,IAXQ;cAAA;cAAA;YAAA;;YAAA,iCAaJ,IAAAG,yBAAA,EAAOV,gBAAP,CAbI;;UAAA;YAAA;YAAA,OAgB0EE,gBAAgB,EAhB1F;;UAAA;YAAA;YAgBLS,kBAhBK,yBAgBLA,kBAhBK;YAgBeC,MAhBf,yBAgBeA,MAhBf;YAgBuBC,uBAhBvB,yBAgBuBA,uBAhBvB;YAgBgDC,eAhBhD,yBAgBgDA,eAhBhD;;YAAA,MAkBRH,kBAAkB,IAAIG,eAAvB,IAA4C,CAACH,kBAAD,IAAuB,CAACG,eAlB3D;cAAA;cAAA;YAAA;;YAAA,MAmBL,IAAIC,KAAJ,CAAU,+DAAV,CAnBK;;UAAA;YAAA,MAoBDH,MAAM,IAAIC,uBAAX,IAAwC,CAACD,MAAD,IAAW,CAACC,uBApBlD;cAAA;cAAA;YAAA;;YAAA,MAqBL,IAAIE,KAAJ,CAAU,+DAAV,CArBK;;UAAA;YAwBPC,IAxBO,GAwBA,IAAAC,eAAA,EAAOV,IAAP,IAAeA,IAAf,GAAsB,IAAAW,kBAAA,EAAU;cAAEf,IAAI,EAAJA,IAAF;cAAQE,KAAK,EAALA,KAAR;cAAeC,IAAI,EAAJA,IAAf;cAAqBC,IAAI,EAAJA,IAArB;cAA2BC,KAAK,EAALA,KAA3B;cAAkCC,MAAM,EAANA;YAAlC,CAAV,CAxBtB,EA0Bb;;YACMU,QA3BO,GA4BXN,uBAAuB,KACtBZ,YAAY,aACLmB,SAAS,CAACR,MAAD,CADJ,6CAELQ,SAAS,CAACR,MAAD,CAFJ,8BADU,CA5BZ;YAgCPS,MAhCO,GAgCEpB,YAAY,2BAAqBmB,SAAS,CAACnB,YAAD,CAA9B,IAAkD,EAhChE;YAiCPqB,GAjCO,qBAiCWH,QAjCX,kCAiC6CE,MAjC7C;YAAA;YAAA,OAmCKE,KAAK,CAACD,GAAD,EAAM;cAC3BE,OAAO;gBACL,gBAAgB,sBADX;gBAEL,4BAA4BpB;cAFvB,GAGDO,kBAAkB,GAClB;gBACEc,aAAa,mBAAad,kBAAb;cADf,CADkB,GAIlB;gBACE,6BAA6BG;cAD/B,CAPC,CADoB;cAY3BY,MAAM,EAAE,MAZmB;cAa3BC,IAAI,EAAEX;YAbqB,CAAN,CAnCV;;UAAA;YAmCPY,GAnCO;;YAAA,IAmDRA,GAAG,CAACC,EAnDI;cAAA;cAAA;YAAA;;YAAA,MAoDL,IAAId,KAAJ,qFAAwFa,GAAG,CAACE,MAA5F,EApDK;;UAAA;YAAA,iCAuDNF,GAAG,CAACG,WAAJ,EAvDM;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,C"}